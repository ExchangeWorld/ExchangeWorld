angular.module("ngScrollable",[]).directive("ngScrollable",["$document","$window","$timeout",function(e,n,l){"use strict";var t={scrollX:"bottom",scrollY:"right",scrollXSlackSpace:0,scrollYSlackSpace:0,wheelSpeed:1,minSliderLength:10,useBothWheelAxes:!1,useKeyboard:!0,updateOnResize:!0};return{restrict:"A",replace:!0,transclude:!0,template:"<div class=\"scrollable\"><div class=\"scrollable-content\" ng-transclude></div><div class='scrollable-bar scrollable-bar-x'><div class='scrollable-slider'></div></div><div class='scrollable-bar scrollable-bar-y'><div class='scrollable-slider'></div></div></div>",link:function(a,o,r){var s,c=angular.extend({},t,a.$eval(r.ngScrollable)),i={window:angular.element(n),content:angular.element(o.children()[0]),barX:angular.element(o.children()[1]),barY:angular.element(o.children()[2]),sliderX:angular.element(angular.element(o.children()[1]).children()[0]),sliderY:angular.element(angular.element(o.children()[2]).children()[0])},d=!1,u=!1,f=0,m=0,h=0,b=0,v=0,g=0,p=0,w=0,k=0,X=0,Y=null,C=null,S=null,y=null,x=!1,I=!1,D=!1,O=function(e){return e.toFixed(3)+"px"},$=function(e,n,l){return Math.max(n,Math.min(e,l))},K=function(){var e;d?(p=Math.max(c.minSliderLength,parseInt(f*f/h,10)),w=parseInt(g*(f-p)/(h-f),10),w>=f-p?w=f-p:0>w&&(w=0),e="translate("+O(w)+",0)",i.sliderX.css({transform:e,"-webkit-transform":e,width:O(p)})):(p=w=0,e="translate(0,0)",i.sliderX.css({transform:e,"-webkit-transform":e,width:0}))},M=function(){var e;u?(k=Math.max(c.minSliderLength,parseInt(m*m/b,10)),X=parseInt(v*(m-k)/(b-m),10),X>=m-k?X=m-k:0>X&&(X=0),e="translate(0,"+O(X)+")",i.sliderY.css({transform:e,"-webkit-transform":e,height:O(k)})):(X=k=0,e="translate(0,0)",i.sliderY.css({transform:e,"-webkit-transform":e,height:0}))},R=function(){var e={left:0,width:O(f),display:d?"inherit":"none"};switch(c.scrollX){case"bottom":e.bottom=0,i.content[d?"addClass":"removeClass"]("scrollable-bottom");break;case"top":e.top=0,i.content[d?"addClass":"removeClass"]("scrollable-top")}i.barX.css(e)},z=function(){var e={top:0,height:O(m),display:u?"inherit":"none"};switch(c.scrollY){case"right":e.right=0,i.content[u?"addClass":"removeClass"]("scrollable-right");break;case"left":e.left=0,i.content[u?"addClass":"removeClass"]("scrollable-left")}i.barY.css(e)},A=function(e,n){v=$(n,0,b-m),g=$(e,0,h-f);var l="translate("+O(-g)+","+O(-v)+")";i.content.css({transform:l,"-webkit-transform":l})},B=function(e){A(e,v),K()},E=function(e){A(g,e),M()},L=function(){f=o[0].offsetWidth,m=o[0].offsetHeight,h=i.content[0].scrollWidth,b=i.content[0].scrollHeight,"none"!==c.scrollX&&f+c.scrollXSlackSpace<h?d=!0:(d=!1,B(0)),"none"!==c.scrollY&&m+c.scrollYSlackSpace<b?u=!0:(u=!1,E(0)),R(),z(),K(),M()},W=function(e,n){e.stopPropagation(),n&&e.preventDefault()},H=function(e){C=e.pageX,Y=g,x=!0,o.addClass("active"),W(e,!0)},P=function(e){if(x){var n=e.pageX-C,l=parseInt(n*(h-f)/(f-p),10);B(Y+l),W(e,!0)}},T=function(){x&&(x=!1,o.removeClass("active"),Y=C=null)},j=function(e){y=e.pageY,S=v,I=!0,o.addClass("active"),W(e,!0)},F=function(e){if(I){var n=e.pageY-y,l=parseInt(n*(b-m)/(m-k),10);E(S+l),W(e,!0)}},q=function(){I&&(I=!1,o.removeClass("active"),S=y=null)},G=function(e){var n=parseInt(p/2,10),l=e.clientX-i.barX[0].getBoundingClientRect().left-n,t=f-p,a=$(l/t,0,1);B((h-f)*a)},J=function(e){var n=parseInt(k/2,10),l=e.clientY-i.barY[0].getBoundingClientRect().top-n,t=m-k,a=$(l/t,0,1);E((b-m)*a)},N=function(){D=!0},Q=function(){D=!1},U=function(n){var l=0,t=0,a=30;if(!(!D||e[0].activeElement.isContentEditable||n.altKey||n.ctrlKey||n.metaKey)){switch(n.which){case 37:l=-a;break;case 38:t=a;break;case 39:l=a;break;case 40:t=-a;break;case 33:t=m;break;case 32:case 34:t=-m;break;case 35:u&&!d?t=-b:l=m;break;case 36:u&&!d?t=b:l=-m;break;default:return}E(v-t),B(g+l),n.preventDefault()}},V=function(e){var n=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t="undefined"!=typeof InstallTrigger,a=(Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,!!window.chrome&&!n),r=!1||!!document.documentMode,i=1;a?i=.5:t?i=20:r&&(i=.4),e=e.originalEvent||e;var f=(angular.isDefined(e.wheelDeltaX)?-e.wheelDeltaX:e.deltaX)*c.wheelSpeed*i,m=(angular.isDefined(e.wheelDeltaY)?-e.wheelDeltaY:e.deltaY)*c.wheelSpeed*i;o.addClass("active"),l.cancel(s),s=l(function(){o.removeClass("active")},500),c.useBothWheelAxes?u&&!d?E(m?v+m:v+f):d&&!u&&B(f?g+f:g+m):(E(v+m),B(g+f)),L(),W(e,!0)};L(),a.$on("content.changed",function(){l(function(){i.content=angular.element(o.children()[0]),L()})}),c.updateOnResize&&i.window.on("resize",L),i.sliderX.on("click",W),i.barX.on("click",G),i.sliderY.on("click",W),i.barY.on("click",J),i.sliderX.on("mousedown",H),e.on("mousemove",P),e.on("mouseup",T),i.sliderY.on("mousedown",j),e.on("mousemove",F),e.on("mouseup",q),c.useKeyboard&&(o.on("mouseenter",N),o.on("mouseleave",Q),e.on("keydown",U)),o.on("wheel",V),o.on("mousewheel",V),a.$on("$destroy",function(){l.cancel(s),c.updateOnResize&&i.window.off("resize",L),i.sliderX.off("click",W),i.barX.off("click",G),i.sliderY.off("click",W),i.barY.off("click",J),i.sliderX.off("mousedown",H),e.off("mousemove",P),e.off("mouseup",T),i.sliderY.off("mousedown",j),e.off("mousemove",F),e.off("mouseup",q),c.useKeyboard&&(o.off("mouseenter",N),o.off("mouseleave",Q),e.off("keydown",U)),o.off("wheel",V),o.off("mousewheel",V)})}}}]);
